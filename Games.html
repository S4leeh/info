<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>S4leeh Minecraft Runner - Pro Edition</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#0a0a0a;
  font-family: 'Cairo', sans-serif;
  touch-action: none;
  overflow: hidden;
}
canvas{
  display:block;
  margin:20px auto;
  background: #87CEEB; /* Ø³ÙŠØªÙ… ØªØºÙŠÙŠØ±Ù‡ Ø¨Ø§Ù„Ø±Ø³Ù… */
  border:4px solid #d4af37;
  border-radius:15px;
  max-width: 95%;
  height: auto;
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
}
.ui{
  position:absolute;
  color:#fff;
  background:rgba(26, 26, 26, 0.9);
  padding:10px 18px;
  border-radius:12px;
  border:2px solid #d4af37;
  font-weight:900;
  z-index: 10;
  backdrop-filter: blur(5px);
}
#score{top:20px;right:30px;}
#top3{top:20px;left:30px; direction: ltr;}
#over{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,0.85);
  z-index: 100;
}
#over div{
  background:#1a1a1a;
  padding:40px;
  border-radius:25px;
  border:3px solid #d4af37;
  color:#fff;
  text-align:center;
  box-shadow: 0 0 50px #000;
}
button{
  padding: 12px 35px;
  font-size: 20px;
  background: #d4af37;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 900;
  color: #000;
  transition: 0.3s;
}
button:hover { background: #fff; transform: scale(1.1); }
</style>
</head>

<body>

<div id="score" class="ui">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
<div id="top3" class="ui">#1: 0 | #2: 0 | #3: 0</div>

<canvas id="game" width="1100" height="450"></canvas>

<div id="over">
  <div>
    <h2 style="color:#d4af37; font-size:35px;">ğŸ’€ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø±Ø­Ù„Ø©</h2>
    <p id="final" style="font-size:20px; margin:20px 0;"></p>
    <button onclick="restart()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
  </div>
</div>

<script>
/* ========= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ========= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const GROUND = 360;
let state = "PLAY";
let frame = 0;
let speed = 4.5; 
let score = 0;
let safeTime = 60;

// Ø³ÙƒÙ†Ø§Øª Ø§Ù„Ø´Ø¨Ø§Ø¨ 3D
const skinNames = ["ISpitfire57","twpywq","Lonely","Abo7abs","S3eedxx","IRimona"];
let obstacles = [];

let highScores = JSON.parse(localStorage.getItem("s4leehTop3")) || [0,0,0];

/* ========= Ø§Ù„Ù„Ø§Ø¹Ø¨ (Saleh 3D) ========= */
const player = {
  x:120,
  y:GROUND-130,
  w:95, // ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ù„ØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù€ 3D
  h:130,
  vy:0,
  jump:false,
  img:new Image()
};
player.img.src = "https://crafatar.com/renders/body/Saleh?scale=4&overlay";

/* ========= Ø§Ù„Ø£ØµÙˆÙ„ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± ========= */
const assets = {};
function load(name,url){
  assets[name]=new Image();
  assets[name].src=url;
}
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¨Ø² Ø¨ÙˆØ¶Ø¹ÙŠØ© 3D
load("Creeper","https://crafatar.com/renders/body/Creeper?scale=4");
load("Zombie","https://crafatar.com/renders/body/Zombie?scale=4");
load("Skeleton","https://crafatar.com/renders/body/Skeleton?scale=4");
// Ø¨Ù„ÙˆÙƒØ§Øª Ø§Ù„Ø£Ø±Ø¶ÙŠØ©
load("Dirt","https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Dirt.png");
load("Lava","https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Lava.png");

/* ========= Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© (Parallax) ========= */
let bgOffset = 0;
function drawBackground() {
    // Ø§Ù„Ø³Ù…Ø§Ø¡
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Ø´Ù…Ø³ Ø¨Ø³ÙŠØ·Ø©
    ctx.fillStyle = "#FFF587";
    ctx.beginPath();
    ctx.arc(900, 80, 40, 0, Math.PI * 2);
    ctx.fill();

    // Ø§Ù„Ø³Ø­Ø¨ (ØªØªØ­Ø±Ùƒ Ø¨Ø¨Ø·Ø¡)
    bgOffset -= 0.5;
    if(bgOffset <= -canvas.width) bgOffset = 0;
    
    ctx.fillStyle = "rgba(255,255,255,0.7)";
    ctx.fillRect(bgOffset + 200, 100, 120, 40);
    ctx.fillRect(bgOffset + 800, 150, 150, 50);
    ctx.fillRect(bgOffset + canvas.width + 200, 100, 120, 40);
}

/* ========= Ø§Ù„ØªØ­ÙƒÙ… ========= */
function doJump() {
  if(!player.jump && state==="PLAY"){
    player.vy=-20; // Ù‚ÙØ²Ø© Ø£Ù‚ÙˆÙ‰ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯
    player.jump=true;
  }
}

document.addEventListener("keydown",e=>{ if(e.code==="Space") doJump(); });
document.addEventListener("touchstart", e => {
  if (state === "PLAY") { e.preventDefault(); doJump(); }
}, {passive: false});

/* ========= Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚ ========= */
function spawnObstacle(){
  let o={x:canvas.width+200,passed:false};
  const t=Math.random();

  if(t<0.45){
    // Ù…ÙˆØ¨Ø²
    const m=["Creeper","Zombie","Skeleton"][Math.floor(Math.random()*3)];
    Object.assign(o,{img:assets[m],w:85,h:120,y:GROUND-120, type:'mob'});
  }else if(t<0.65){
    // Ø¨Ù„ÙˆÙƒØ§Øª (Ù„Ø§ÙØ§ Ø£Ùˆ Ø¯Ø±Øª)
    const b=Math.random() > 0.5 ? "Dirt" : "Lava";
    Object.assign(o,{img:assets[b],w:60,h:60,y:GROUND-60, type:'block'});
  }else{
    // Ø³ÙƒÙ†Ø§Øª Ø§Ù„Ø´Ø¨Ø§Ø¨ 3D
    const n=skinNames[Math.floor(Math.random()*skinNames.length)];
    o.img=new Image();
    o.img.src=`https://crafatar.com/renders/body/${n}?scale=4&overlay`;
    Object.assign(o,{w:85,h:120,y:GROUND-120, type:'skin'});
  }
  obstacles.push(o);
}

/* ========= ÙƒØ´Ù Ø§Ù„ØªØµØ§Ø¯Ù… ========= */
function collide(a,b){
  // ØªÙ‚Ù„ÙŠØµ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØµØ§Ø¯Ù… Ù‚Ù„ÙŠÙ„Ø§Ù‹ (Hitbox) Ù„ÙŠÙƒÙˆÙ† Ø§Ù„Ù„Ø¹Ø¨ Ø¹Ø§Ø¯Ù„Ø§Ù‹
  const paddingX = 20;
  const paddingY = 10;
  return a.x + paddingX < b.x + b.w - paddingX &&
         a.x + a.w - paddingX > b.x + paddingX &&
         a.y + paddingY < b.y + b.h - paddingY &&
         a.y + a.h - paddingY > b.y + paddingY;
}

/* ========= Ø§Ù„Ø­Ù„Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ========= */
function loop(){
  if(state!=="PLAY")return;
  frame++;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawBackground();

  // Ø±Ø³Ù… Ø§Ù„Ø£Ø±Ø¶ÙŠØ© (Ø¨Ù„ÙˆÙƒØ§Øª Dirt Ù…ØªÙƒØ±Ø±Ø©)
  for(let i=0; i<canvas.width; i+=50) {
      ctx.drawImage(assets["Dirt"], i, GROUND, 50, 50);
  }

  // ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨
  player.vy+=0.8; // Ø¬Ø§Ø°Ø¨ÙŠØ© Ø£Ù‚ÙˆÙ‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹
  player.y+=player.vy;
  if(player.y>=GROUND-player.h){
    player.y=GROUND-player.h;
    player.vy=0;
    player.jump=false;
  }
  
  // ØªØ£Ø«ÙŠØ± Ø¸Ù„ Ø¨Ø³ÙŠØ· ØªØ­Øª Ø§Ù„Ù„Ø§Ø¹Ø¨
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.beginPath();
  ctx.ellipse(player.x + player.w/2, GROUND, 30, 10, 0, 0, Math.PI*2);
  ctx.fill();

  ctx.drawImage(player.img,player.x,player.y,player.w,player.h);

  // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙˆØ§Ø¦Ù‚
  if(frame % Math.floor(120 - speed) === 0) spawnObstacle();

  obstacles.forEach(o=>{
    o.x-=speed;
    
    if(o.img.complete) {
        ctx.drawImage(o.img,o.x,o.y,o.w,o.h);
    }

    if(!o.passed && o.x+o.w<player.x){
      score+=14;
      o.passed=true;
      speed += 0.05; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹
    }

    if(safeTime<=0 && collide(player,o)){
      gameOver();
    }
  });

  obstacles=obstacles.filter(o=>o.x>-100);
  if(safeTime>0)safeTime--;

  document.getElementById("score").innerText="Ø§Ù„Ù†Ù‚Ø§Ø·: "+score;
  document.getElementById("top3").innerText=
    `#1: ${highScores[0]} | #2: ${highScores[1]} | #3: ${highScores[2]}`;

  requestAnimationFrame(loop);
}

/* ========= Ù†Ù‡Ø§ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© ========= */
function gameOver(){
  state="OVER";
  document.getElementById("over").style.display="flex";
  document.getElementById("final").innerText=`Ø­Ù‚Ù‚Øª ${score} Ù†Ù‚Ø·Ø©`;
  highScores.push(score);
  highScores.sort((a,b)=>b-a);
  highScores=highScores.slice(0,3);
  localStorage.setItem("s4leehTop3",JSON.stringify(highScores));
}

function restart(){
  state = "PLAY";
  score = 0;
  frame = 0;
  speed = 4.5;
  obstacles = [];
  safeTime = 60;
  player.y = GROUND - player.h;
  player.vy = 0;
  player.jump = false;
  document.getElementById("over").style.display = "none";
  loop();
}

// Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
window.onload = () => { loop(); };
</script>

</body>
</html>
