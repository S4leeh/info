<!DOCTYPE html>
<html class="dark" lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>S4leeh | Ù…ØºØ§Ù…Ø±Ø© ØµØ§Ù„Ø­</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700;800&family=Cairo:wght@700;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<style>
    /* --- Game Styles (Night Mode) --- */
    :root { --gold: #d4af37; --bg-dark: #0a0a0a; --night-sky: #1a1a2e; }
    
    /* Voxel Background Animation */
    .voxel-bg {
        background-image: 
            linear-gradient(rgba(32, 29, 18, 0.85), rgba(10, 10, 10, 0.95)),
            linear-gradient(90deg, rgba(212, 175, 53, 0.05) 1px, transparent 1px),
            linear-gradient(rgba(212, 175, 53, 0.05) 1px, transparent 1px);
        background-size: 100% 100%, 40px 40px, 40px 40px;
        background-position: center bottom;
        transform: perspective(500px) rotateX(20deg) scale(1.5);
        height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; z-index: 0; pointer-events: none;
    }

    /* Game Canvas Container */
    #game-container {
        display: none; /* Hidden by default */
        position: fixed; inset: 0; z-index: 50;
        background: #0a0a0a;
        flex-direction: column; align-items: center; justify-content: center;
    }

    canvas { 
        display: block; background: var(--night-sky); 
        border: 4px solid var(--gold); border-radius: 15px; 
        width: 95vw; height: auto; max-height: 65vh; 
        box-shadow: 0 0 40px rgba(0,0,0,0.9); image-rendering: pixelated; 
    }

    /* UI Overlay for Game */
    .game-ui { position: absolute; top: 15px; width: 95vw; max-width: 850px; display: flex; justify-content: space-between; z-index: 60; pointer-events: none; }
    .score-badge { background: rgba(0,0,0,0.8); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 8px; color: white; font-family: 'Cairo'; font-weight: bold; }

    /* Game Over / Pause Screen */
    #msg-overlay { 
        position: absolute; inset: 0; display: none; 
        align-items: center; justify-content: center; 
        background: rgba(0,0,0,0.9); z-index: 100; 
        flex-direction: column; text-align: center;
    }
    
    /* 3D Button Effect */
    .btn-3d {
        transition: all 0.1s;
        box-shadow: 0px 6px 0px 0px #8f7216, 0px 10px 20px rgba(0,0,0,0.4); 
        transform: translateY(0);
    }
    .btn-3d:active { transform: translateY(6px); box-shadow: 0px 0px 0px 0px #8f7216; }

    /* Animations */
    .tilt-card { transition: transform 0.3s ease; }
    .tilt-card:hover { transform: scale(1.05); }
    
    body { font-family: 'Cairo', sans-serif; overflow: hidden; user-select: none; -webkit-user-select: none; }
</style>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: { "primary": "#d4af35", "background-dark": "#0a0a0a" },
                fontFamily: { "display": ["Cairo", "sans-serif"] }
            }
        }
    }
</script>
</head>
<body class="bg-background-dark text-white h-screen w-screen relative">

<div id="main-menu" class="relative z-10 w-full h-full flex flex-col justify-between p-4 overflow-hidden">
    <div class="voxel-bg"></div>

    <div class="flex justify-between items-start w-full max-w-6xl mx-auto relative z-20">
        <div class="tilt-card bg-black/40 backdrop-blur-md border border-primary/30 rounded-xl p-3 shadow-lg flex items-center gap-3">
            <div class="w-10 h-10 flex items-center justify-center bg-primary/20 rounded-lg text-primary">
                <span class="material-icons">monetization_on</span>
            </div>
            <div>
                <p class="text-[10px] text-gray-400 uppercase font-bold">Ø§Ù„Ø±ØµÙŠØ¯</p>
                <h2 class="text-xl font-bold text-primary">14,250</h2>
            </div>
        </div>

        <div class="flex items-center gap-2 bg-black/60 border border-primary/30 rounded-full pl-1 pr-4 py-1 backdrop-blur-sm">
            <img src="https://minotar.net/avatar/Saleh/100.png" class="w-8 h-8 rounded-full border border-primary">
            <span class="font-bold text-sm">Saleh</span>
        </div>

        <div class="tilt-card bg-black/40 backdrop-blur-md border border-primary/30 rounded-xl p-3 shadow-lg flex items-center gap-3 dir-ltr">
            <div class="text-right">
                <p class="text-[10px] text-gray-400 uppercase font-bold">Ø£ÙØ¶Ù„ Ø±Ù‚Ù…</p>
                <h2 id="menu-highscore" class="text-xl font-bold text-white">0</h2>
            </div>
            <div class="w-10 h-10 flex items-center justify-center bg-gray-800 rounded-lg text-primary border border-primary/20">
                <span class="material-icons">emoji_events</span>
            </div>
        </div>
    </div>

    <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
        <div class="relative group">
            <div class="absolute bottom-0 left-1/2 -translate-x-1/2 w-40 h-10 bg-primary/20 blur-xl rounded-full animate-pulse"></div>
            <img src="https://crafatar.com/renders/body/Saleh?scale=8&overlay" class="h-[50vh] object-contain drop-shadow-2xl hover:scale-105 transition duration-500">
        </div>
    </div>

    <div class="hidden md:block absolute right-10 top-1/2 -translate-y-1/2 w-72 bg-black/80 backdrop-blur-xl border-r-4 border-primary rounded-l-xl p-5 shadow-2xl z-20">
        <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <span class="material-icons text-primary">assignment</span> Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…
        </h3>
        <div class="space-y-4">
            <div>
                <div class="flex justify-between text-xs mb-1 text-gray-300">
                    <span>Ø§Ø¬Ù…Ø¹ 500 Ù†Ù‚Ø·Ø©</span>
                    <span class="text-primary">300/500</span>
                </div>
                <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                    <div class="h-full bg-primary w-[60%]"></div>
                </div>
            </div>
            <div>
                <div class="flex justify-between text-xs mb-1 text-green-400">
                    <span>ØªØ¬Ø§ÙˆØ² Ø³Ø¹ÙŠØ¯</span>
                    <span class="flex items-center gap-1"><span class="material-icons text-[10px]">check_circle</span> ØªÙ…</span>
                </div>
                <div class="h-1.5 bg-gray-800 rounded-full overflow-hidden">
                    <div class="h-full bg-green-500 w-full"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="w-full flex justify-center pb-12 z-30 relative">
        <button onclick="switchToGame()" class="btn-3d relative w-72 h-20 bg-primary hover:bg-[#eac448] text-black font-black text-3xl rounded-xl border-2 border-[#fceda8] flex flex-col items-center justify-center overflow-hidden group">
            <span class="relative z-10 drop-shadow-sm">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</span>
            <span class="relative z-10 text-[12px] font-bold opacity-70 tracking-widest mt-[-2px]">Ø§Ø¶ØºØ· Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚</span>
            <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-white/30 to-transparent opacity-50"></div>
        </button>
        
        <a href="index.html" class="absolute bottom-2 text-gray-500 text-xs hover:text-primary transition">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </div>
</div>

<div id="game-container">
    <div class="game-ui">
        <div class="score-badge" id="top3">#1: 0 | #2: 0</div>
        <div class="score-badge" id="score">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
    </div>

    <canvas id="game" width="850" height="420"></canvas>

    <div id="msg-overlay">
        <h2 id="msg-text" class="text-3xl text-primary font-bold mb-2"></h2>
        <p id="death-reason" class="text-red-400 bg-red-900/30 px-4 py-1 rounded-full mb-6 font-bold"></p>
        <button class="btn-3d bg-primary text-black font-bold px-8 py-3 rounded-lg text-xl" onclick="resetGame()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        <button class="text-gray-400 mt-4 text-sm hover:text-white" onclick="backToMenu()">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
</div>

<script>
/* ================= GAME LOGIC ================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d", { alpha: false });
ctx.imageSmoothingEnabled = false;

const GROUND = 340;
let state = "MENU"; // States: MENU, PLAY, OVER
let score = 0, baseSpeed = 5.5, speed = baseSpeed, frame = 0, nextSpawnFrame = 100;
let highScores = JSON.parse(localStorage.getItem("s4leehTop3")) || [0,0,0];

// Update menu highscore display
document.getElementById('menu-highscore').innerText = highScores[0];

const player = { x:80, y:GROUND-100, w:75, h:100, vy:0, jump:false };
let obstacles = [];
const skins = ["ISpitfire57","twpywq","Lonely","Abo7abs","S3eedxx","IRimona","7og9_"];

const assets = {};
const toLoad = [
    { n: "Saleh", u: "https://minotar.net/armor/body/Saleh/100.png" },
    { n: "Creeper", u: "https://minotar.net/armor/body/Creeper/100.png" },
    { n: "Zombie", u: "https://minotar.net/armor/body/Zombie/100.png" },
    { n: "Dirt", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Dirt.png" },
    { n: "Lava", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Lava.png" },
    { n: "Stone", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/1d/Stone.png" },
    { n: "Cobblestone", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3c/Cobblestone.png" }
];

let loaded = 0;
toLoad.forEach(item => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = item.u;
    img.onload = () => loaded++;
    assets[item.n] = img;
});

// UI Switching Functions
function switchToGame() {
    if(loaded < toLoad.length) return alert("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ØŒ Ø§Ù†ØªØ¸Ø± Ù„Ø­Ø¸Ø©...");
    document.getElementById('main-menu').style.display = 'none';
    document.getElementById('game-container').style.display = 'flex';
    resetGame();
}

function backToMenu() {
    document.getElementById('game-container').style.display = 'none';
    document.getElementById('main-menu').style.display = 'flex';
    state = "MENU";
    document.getElementById('menu-highscore').innerText = highScores[0];
}

function resetGame() {
    score = 0; speed = baseSpeed; frame = 0; obstacles = [];
    player.y = GROUND - player.h; player.vy = 0; player.jump = false;
    nextSpawnFrame = 80;
    document.getElementById("msg-overlay").style.display = "none";
    state = "PLAY";
    requestAnimationFrame(loop);
}

// Game Mechanics
function doJump() {
    if(!player.jump && state === "PLAY") {
        player.vy = -18.5;
        player.jump = true;
    }
}

document.addEventListener("keydown", e => { 
    if(e.code === "Space" && state === "PLAY") doJump();
});

window.addEventListener("touchstart", e => { 
    if (state === "PLAY" && e.target.tagName !== 'BUTTON') {
        e.preventDefault(); doJump();
    }
}, {passive: false});

function spawn() {
    const rand = Math.random();
    let o = { x: canvas.width + 120, passed: false, name: "" };

    if(rand < 0.35) { 
        const m = Math.random() > 0.5 ? "Creeper" : "Zombie";
        Object.assign(o, { img: assets[m], w: 75, h: 105, y: GROUND-105, name: m });
    } else if(rand < 0.70) { 
        const blocks = ["Dirt", "Lava", "Stone", "Cobblestone"];
        const b = blocks[Math.floor(Math.random() * blocks.length)];
        Object.assign(o, { img: assets[b], w: 60, h: 60, y: GROUND-60, name: b });
    } else { 
        const s = skins[Math.floor(Math.random()*skins.length)];
        const skinImg = new Image();
        skinImg.crossOrigin = "anonymous";
        skinImg.src = `https://minotar.net/armor/body/${s}/100.png`;
        Object.assign(o, { img: skinImg, w: 75, h: 105, y: GROUND-105, name: s });
    }
    
    obstacles.push(o);
    const minSafeGap = 55; 
    const randomExtraGap = Math.floor(Math.random() * 85); 
    nextSpawnFrame = frame + minSafeGap + randomExtraGap;
}

function loop() {
    if(state !== "PLAY") return;
    frame++;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Night Environment
    ctx.fillStyle = "#0f0f1b"; ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Stars
    ctx.fillStyle = "white";
    if (frame % 2 === 0) { 
        ctx.fillRect(100, 50, 2, 2); ctx.fillRect(300, 80, 2, 2);
        ctx.fillRect(500, 40, 2, 2); ctx.fillRect(700, 90, 2, 2);
    }
    // Moon
    ctx.fillStyle = "#f5f5f5"; ctx.beginPath(); ctx.arc(750, 60, 25, 0, Math.PI * 2); ctx.fill();

    // Ground
    ctx.fillStyle = "#2d1d0f"; ctx.fillRect(0, GROUND, canvas.width, canvas.height-GROUND);
    ctx.fillStyle = "#2a4d1a"; ctx.fillRect(0, GROUND, canvas.width, 12);

    // Player Physics
    player.vy += 0.85; 
    player.y += player.vy;
    if(player.y >= GROUND-player.h) { player.y = GROUND-player.h; player.vy = 0; player.jump = false; }
    
    // Player Draw with Glow
    ctx.shadowBlur = 10; ctx.shadowColor = "rgba(212, 175, 55, 0.3)";
    if(assets["Saleh"]) ctx.drawImage(assets["Saleh"], player.x, player.y, player.w, player.h);
    ctx.shadowBlur = 0;

    if(frame >= nextSpawnFrame) spawn();

    // Obstacles Logic
    for(let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= speed;
        if(o.img && (o.img.complete || o.img.naturalWidth > 0)) ctx.drawImage(o.img, o.x, o.y, o.w, o.h);

        if(!o.passed && o.x + o.w < player.x) { 
            score += 14; o.passed = true; speed += 0.05; 
        }
        
        if(player.x+25 < o.x+o.w-25 && player.x+player.w-25 > o.x+25 && 
           player.y+15 < o.y+o.h-10 && player.y+player.h-10 > o.y+15) {
            gameOver(o.name);
            return;
        }
        if(o.x < -150) obstacles.splice(i, 1);
    }

    document.getElementById("score").innerText = "Ø§Ù„Ù†Ù‚Ø§Ø·: " + score;
    document.getElementById("top3").innerText = `#1: ${highScores[0]} | #2: ${highScores[1]}`;
    requestAnimationFrame(loop);
}

function gameOver(killerName) {
    state = "OVER";
    document.getElementById("msg-overlay").style.display = "flex";
    document.getElementById("msg-text").innerText = "ğŸ’€ Ø³Ù‚Ø· ØµØ§Ù„Ø­!";
    document.getElementById("death-reason").innerText = "Ø§Ù„Ø³Ø¨Ø¨: " + killerName;
    
    highScores.push(score); highScores.sort((a,b)=>b-a); highScores = highScores.slice(0,3);
    localStorage.setItem("s4leehTop3", JSON.stringify(highScores));
}
</script>
</body>
</html>
