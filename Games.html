<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>S4leeh | Ù…ØºØ§Ù…Ø±Ø© ØµØ§Ù„Ø­ </title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
<style>
    :root { --gold: #d4af37; --bg-dark: #0a0a0a; --night-sky: #1a1a2e; }
    html, body { 
        margin: 0; padding: 0; background: var(--bg-dark); 
        font-family: 'Cairo', sans-serif; touch-action: none; 
        overflow: hidden; color: white; height: 100%; width: 100%;
    }
    .brand-header {
        text-align: center;
        padding: 10px 0;
        background: rgba(10, 10, 20, 0.9);
        border-bottom: 2px solid rgba(212, 175, 55, 0.2);
    }
    .logo { width: 60px; height: auto; margin-bottom: 5px; }
    .game-title { font-size: 22px; font-weight: 900; color: var(--gold); margin: 0; }
    #game-wrap { 
        position: relative; 
        width: 100%; 
        max-width: 1000px;
        margin: 10px auto;
        display: flex;
        justify-content: center;
    }
    canvas { 
        display: block; 
        background: var(--night-sky); 
        border: 4px solid var(--gold); 
        border-radius: 15px; 
        width: 95vw; 
        height: auto; 
        max-height: 65vh;
        box-shadow: 0 0 40px rgba(0,0,0,0.9); 
        image-rendering: pixelated;
    }
    .ui { 
        position: absolute; 
        color: #fff; 
        background: rgba(0,0,0,0.85); 
        padding: 5px 12px; 
        border-radius: 8px; 
        border: 1px solid var(--gold); 
        font-weight: bold; 
        z-index: 10; 
        font-size: 14px;
        backdrop-filter: blur(4px);
    }
    #score { top: 10px; right: 10px; }
    #top3 { top: 10px; left: 10px; direction: ltr; font-size: 11px; }
    #msg { 
        position: absolute; 
        inset: 0; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        background: rgba(0,0,0,0.9); 
        z-index: 100; 
        color: var(--gold); 
        text-align: center; 
        border-radius: 15px; 
        flex-direction: column; 
        padding: 20px;
        width: 90%;
        margin: auto;
    }
    #msg-text { font-size: 22px; margin-bottom: 5px; font-weight: 900; }
    #death-reason { font-size: 16px; color: #ff4d4d; margin-bottom: 15px; font-weight: 700; background: rgba(255,0,0,0.1); padding: 5px 15px; border-radius: 20px; }
    button { 
        padding: 12px 35px; 
        font-size: 18px; 
        background: var(--gold); 
        border: none; 
        border-radius: 8px; 
        cursor: pointer; 
        font-weight: 900; 
        color: #000; 
        transition: 0.3s;
        z-index: 101;
    }
    button:active { transform: scale(0.95); }
    .nav-back {
        display: block;
        text-align: center;
        margin-top: 5px;
        color: #888;
        text-decoration: none;
        font-size: 13px;
    }
    @media (max-width: 600px) {
        .game-title { font-size: 18px; }
        #msg-text { font-size: 18px; }
    }
</style>
</head>
<body>

<header class="brand-header">
    <img src="logo.png" alt="S4leeh Logo" class="logo">
    <h1 class="game-title">Ù…ØºØ§Ù…Ø±Ø© ØµØ§Ù„Ø­</h1>
</header>

<div id="game-wrap">
    <div id="score" class="ui">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
    <div id="top3" class="ui">#1: 0 | #2: 0 | #3: 0</div>
    <canvas id="game" width="850" height="420"></canvas>
    <div id="msg">
        <h2 id="msg-text">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø¹Ø§Ù„Ù… ØµØ§Ù„Ø­...</h2>
        <p id="death-reason"></p>
        <button id="start-btn" style="display:none;" onclick="startGame(event)">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø© ðŸŒ™</button>
    </div>
</div>

<a href="index.html" class="nav-back">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d", { alpha: false });
ctx.imageSmoothingEnabled = false;

const GROUND = 340;
let state = "LOADING", score = 0, baseSpeed = 5.5, speed = baseSpeed, frame = 0, nextSpawnFrame = 100;
let highScores = JSON.parse(localStorage.getItem("s4leehTop3")) || [0,0,0];

const player = { x:80, y:GROUND-100, w:75, h:100, vy:0, jump:false };
let obstacles = [];
const skins = ["ISpitfire57","twpywq","Lonely","Abo7abs","S3eedxx","IRimona","7og9_","Raheeb_","KMA77","Z4_clown_king","Nina__a"];

const assets = {};
const toLoad = [
    { n: "Saleh", u: "https://minotar.net/armor/body/Saleh/100.png" },
    { n: "Creeper", u: "https://minotar.net/armor/body/Creeper/100.png" },
    { n: "Zombie", u: "https://minotar.net/armor/body/Zombie/100.png" },
    { n: "Dirt", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Dirt.png" },
    { n: "Lava", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Lava.png" },
    { n: "Stone", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/1/1d/Stone.png" },
    { n: "Cobblestone", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/3c/Cobblestone.png" }
];

let loaded = 0;
toLoad.forEach(item => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = item.u;
    img.onload = () => { loaded++; if(loaded >= toLoad.length) showStartButton(); };
    img.onerror = () => { loaded++; if(loaded >= toLoad.length) showStartButton(); };
    assets[item.n] = img;
});

function showStartButton() {
    document.getElementById("msg-text").innerText = "Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…ØºØ§Ù…Ø±Ø© Ø§Ù„Ù„ÙŠÙ„ÙŠØ©ØŸ";
    document.getElementById("death-reason").innerText = "";
    document.getElementById("start-btn").style.display = "block";
}

function startGame(e) {
    if (e) e.stopPropagation();
    score = 0; speed = baseSpeed; frame = 0; obstacles = [];
    player.y = GROUND - player.h; player.vy = 0; player.jump = false;
    nextSpawnFrame = 80; 
    document.getElementById("msg").style.display = "none";
    document.getElementById("death-reason").innerText = "";
    state = "PLAY";
    requestAnimationFrame(loop);
}

function doJump() {
    if(!player.jump && state === "PLAY") {
        player.vy = -18.5;
        player.jump = true;
    }
}

// Ø§Ù„ØªØ­ÙƒÙ…: ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù…Ù†Ø¹ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø²Ø± Ø§Ù„Ø³Ø¨ÙŠØ³
document.addEventListener("keydown", e => { 
    if(e.code === "Space") {
        if(state === "PLAY") {
            doJump();
        }
        // ØªÙ… Ø­Ø°Ù Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø£Ùˆ Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ø¨Ø²Ø± Ø§Ù„Ø³Ø¨ÙŠØ³ Ù‡Ù†Ø§ Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„Ø¶ØºØ· Ø¨Ø§Ù„Ø®Ø·Ø£
    }
});

window.addEventListener("touchstart", e => { 
    if (state === "PLAY" && e.target.tagName !== 'BUTTON') {
        e.preventDefault(); doJump();
    }
}, {passive: false});

function spawn() {
    const rand = Math.random();
    let o = { x: canvas.width + 120, passed: false, name: "" };

    if(rand < 0.35) { 
        const m = Math.random() > 0.5 ? "Creeper" : "Zombie";
        Object.assign(o, { img: assets[m], w: 75, h: 105, y: GROUND-105, name: m });
    } else if(rand < 0.70) { 
        const blocks = ["Dirt", "Lava", "Stone", "Cobblestone"];
        const b = blocks[Math.floor(Math.random() * blocks.length)];
        Object.assign(o, { img: assets[b], w: 60, h: 60, y: GROUND-60, name: b });
    } else { 
        const s = skins[Math.floor(Math.random()*skins.length)];
        const skinImg = new Image();
        skinImg.crossOrigin = "anonymous";
        skinImg.src = `https://minotar.net/armor/body/${s}/100.png`;
        Object.assign(o, { img: skinImg, w: 75, h: 105, y: GROUND-105, name: s });
    }
    
    obstacles.push(o);
    const minSafeGap = 55; 
    const randomExtraGap = Math.floor(Math.random() * 85); 
    nextSpawnFrame = frame + minSafeGap + randomExtraGap;
}

function loop() {
    if(state !== "PLAY") return;
    frame++;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // --- Ø±Ø³Ù… Ø§Ù„Ù„ÙŠÙ„ ---
    ctx.fillStyle = "#0f0f1b"; 
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = "white";
    if (frame % 2 === 0) { 
        ctx.fillRect(100, 50, 2, 2); ctx.fillRect(300, 80, 2, 2);
        ctx.fillRect(500, 40, 2, 2); ctx.fillRect(700, 90, 2, 2);
    }
    
    ctx.fillStyle = "#f5f5f5";
    ctx.beginPath();
    ctx.arc(750, 60, 25, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#2d1d0f"; ctx.fillRect(0, GROUND, canvas.width, canvas.height-GROUND);
    ctx.fillStyle = "#2a4d1a"; ctx.fillRect(0, GROUND, canvas.width, 12);

    player.vy += 0.85; 
    player.y += player.vy;
    if(player.y >= GROUND-player.h) { player.y = GROUND-player.h; player.vy = 0; player.jump = false; }
    
    ctx.shadowBlur = 10; ctx.shadowColor = "rgba(212, 175, 55, 0.3)";
    if(assets["Saleh"]) ctx.drawImage(assets["Saleh"], player.x, player.y, player.w, player.h);
    ctx.shadowBlur = 0;

    if(frame >= nextSpawnFrame) spawn();

    for(let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= speed;
        if(o.img && (o.img.complete || o.img.naturalWidth > 0)) {
            ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
        }

        if(!o.passed && o.x + o.w < player.x) { 
            score += 14; o.passed = true; speed += 0.05; 
        }
        
        if(player.x+25 < o.x+o.w-25 && player.x+player.w-25 > o.x+25 && 
           player.y+15 < o.y+o.h-10 && player.y+player.h-10 > o.y+15) {
            gameOver(o.name);
            return;
        }
        if(o.x < -150) obstacles.splice(i, 1);
    }

    document.getElementById("score").innerText = "Ø§Ù„Ù†Ù‚Ø§Ø·: " + score;
    document.getElementById("top3").innerText = `#1: ${highScores[0]} | #2: ${highScores[1]} | #3: ${highScores[2]}`;
    requestAnimationFrame(loop);
}

function gameOver(killerName) {
    state = "OVER";
    document.getElementById("msg").style.display = "flex";
    document.getElementById("msg-text").innerHTML = "ðŸ’€ Ø¥Ù†ØªÙ‡Øª Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©!<br>Ù†Ù‚Ø§Ø·Ùƒ: " + score;
    document.getElementById("death-reason").innerText = "Ø§Ù„Ø³Ø¨Ø¨: " + killerName;
    document.getElementById("start-btn").innerText = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©";
    highScores.push(score); highScores.sort((a,b)=>b-a); highScores = highScores.slice(0,3);
    localStorage.setItem("s4leehTop3", JSON.stringify(highScores));
}

window.onload = () => { if(loaded >= toLoad.length) showStartButton(); };
</script>
</body>
</html>
