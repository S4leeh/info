// أضف هذه المتغيرات أعلى السكربت
let safeTime = 60; // فريمات أمان
let spawnDelay = 120;

// عدّل spawnObstacle
function spawnObstacle() {
    const type = Math.random();
    let o = { 
        x: canvas.width + 300, // ⬅️ مسافة أمان
        passed: false 
    };

    if (type < 0.4) {
        const mob = ["Creeper","Zombie","Skeleton"][Math.floor(Math.random()*3)];
        Object.assign(o,{
            img:assets[mob],
            w:75,h:110,
            y:GROUND-110
        });
    } 
    else if (type < 0.7) {
        const block = ["Dirt","Cobblestone","Stone","Lava"][Math.floor(Math.random()*4)];
        Object.assign(o,{
            img:assets[block],
            w:50,h:50,
            y:GROUND-50
        });
    } 
    else {
        const name = skinNames[Math.floor(Math.random()*skinNames.length)];
        o.img = new Image();
        o.img.src = `https://minotar.net/armor/body/${name}/100.png`;
        Object.assign(o,{
            w:75,h:110,
            y:GROUND-110
        });
    }
    obstacles.push(o);
}

// داخل loop() عدّل التصادم
if (safeTime <= 0 && collide(player,o)) {
    state="OVER";
    document.getElementById("final").innerText=`حققت ${score} نقطة`;
    document.getElementById("over").style.display="flex";
    highScores.push(score);
    highScores.sort((a,b)=>b-a);
    localStorage.setItem("s4leehTop3",JSON.stringify(highScores.slice(0,3)));
}

// تقليل safeTime
if (safeTime > 0) safeTime--;

// تعديل توليد العوائق
if (frame > spawnDelay && frame % 140 === 0) {
    spawnObstacle();
}
