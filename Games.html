<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>S4leeh Minecraft Runner - V2</title>
<style>
    html,body{ margin:0; padding:0; background:#0a0a0a; font-family: sans-serif; touch-action: none; overflow: hidden; }
    #game-wrap { position: relative; width: fit-content; margin: 20px auto; }
    canvas{ display:block; background: #87CEEB; border:4px solid #d4af37; border-radius:15px; max-width: 95vw; height: auto; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    .ui{ position:absolute; color:#fff; background:rgba(0,0,0,0.8); padding:8px 15px; border-radius:10px; border:1px solid #d4af37; font-weight:bold; z-index: 10; }
    #score{top:15px; right:15px;}
    #top3{top:15px; left:15px; direction: ltr; font-size: 12px;}
    #msg { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); z-index: 100; color: #d4af37; text-align: center; border-radius: 15px; flex-direction: column; padding: 20px; }
    button { padding: 15px 40px; font-size: 20px; background: #d4af37; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 20px; color: #000; transition: 0.2s; }
    button:hover { transform: scale(1.1); background: #fff; }
</style>
</head>
<body>

<div id="game-wrap">
    <div id="score" class="ui">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
    <div id="top3" class="ui">#1: 0 | #2: 0 | #3: 0</div>
    
    <canvas id="game" width="1000" height="400"></canvas>

    <div id="msg">
        <h2 id="msg-text">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¹Ø§Ù„Ù…...</h2>
        <button id="start-btn" style="display:none;" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</button>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const GROUND = 330;

// Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
let state = "LOADING";
let score = 0;
let baseSpeed = 4.5;
let speed = baseSpeed;
let frame = 0;
let nextSpawnFrame = 100; // Ù„Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
let highScores = JSON.parse(localStorage.getItem("s4leehTop3")) || [0,0,0];

const player = { x:80, y:GROUND-100, w:75, h:100, vy:0, jump:false, img: new Image() };
let obstacles = [];
const skins = ["ISpitfire57","twpywq","Lonely","Abo7abs","S3eedxx","IRimona"];

// Ø§Ù„Ø£ØµÙˆÙ„ (Ø§Ù„Ù…ÙˆØ¨Ø² ÙˆØ§Ù„Ø¨Ù„ÙˆÙƒØ§Øª)
const assets = {};
const toLoad = [
    { n: "Saleh", u: "https://minotar.net/armor/body/Saleh/100.png" },
    { n: "Creeper", u: "https://minotar.net/armor/body/Creeper/100.png" },
    { n: "Zombie", u: "https://minotar.net/armor/body/Zombie/100.png" },
    { n: "Dirt", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/2/2f/Dirt.png" },
    { n: "Lava", u: "https://static.wikia.nocookie.net/minecraft_gamepedia/images/3/30/Lava.png" }
];

let loaded = 0;
toLoad.forEach(item => {
    const img = new Image();
    img.crossOrigin = "anonymous";
    img.src = item.u;
    img.onload = () => { loaded++; if(loaded >= toLoad.length) showStartButton(); };
    img.onerror = () => { loaded++; if(loaded >= toLoad.length) showStartButton(); };
    assets[item.n] = img;
});

function showStartButton() {
    document.getElementById("msg-text").innerText = "Ø¬Ø§Ù‡Ø² ÙŠØ§ ØµØ§Ù„Ø­ØŸ";
    document.getElementById("start-btn").style.display = "block";
}

function startGame() {
    // ØªØµÙÙŠØ± ÙƒØ§Ù…Ù„ Ù„Ù„Ù‚ÙŠÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥Ø¹Ø§Ø¯Ø©
    score = 0;
    speed = baseSpeed;
    frame = 0;
    obstacles = [];
    player.y = GROUND - player.h;
    player.vy = 0;
    player.jump = false;
    nextSpawnFrame = 80; 

    document.getElementById("msg").style.display = "none";
    state = "PLAY";
    if (loaded >= toLoad.length) loop(); 
}

function doJump() {
    if(!player.jump && state === "PLAY") {
        player.vy = -18;
        player.jump = true;
    }
}

document.addEventListener("keydown", e => { if(e.code==="Space") doJump(); });
document.addEventListener("touchstart", e => { e.preventDefault(); doJump(); }, {passive: false});

function spawn() {
    const rand = Math.random();
    let o = { x: canvas.width + 150, passed: false };

    if(rand < 0.4) { // Ù…ÙˆØ¨Ø² (40%)
        const m = Math.random() > 0.5 ? "Creeper" : "Zombie";
        Object.assign(o, { type: "Img", img: assets[m], w: 75, h: 105, y: GROUND-105 });
    } else if(rand < 0.7) { // Ø¨Ù„ÙˆÙƒØ§Øª (30%)
        const b = Math.random() > 0.5 ? "Dirt" : "Lava";
        Object.assign(o, { type: "Img", img: assets[b], w: 60, h: 60, y: GROUND-60 });
    } else { // Ø´Ø¨Ø§Ø¨ (30%)
        const s = skins[Math.floor(Math.random()*skins.length)];
        const skinImg = new Image();
        skinImg.src = `https://minotar.net/armor/body/${s}/100.png`;
        Object.assign(o, { type: "Img", img: skinImg, w: 75, h: 105, y: GROUND-105 });
    }
    obstacles.push(o);
    
    // ØªØ­Ø¯ÙŠØ¯ ÙˆÙ‚Øª Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚Ø§Ø¯Ù… Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ (Ø¨ÙŠÙ† 70 Ùˆ 150 Ø¥Ø·Ø§Ø±) Ù„Ø¬Ø¹Ù„Ù‡Ø§ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©
    nextSpawnFrame = frame + Math.floor(Math.random() * 80) + 70;
}

function loop() {
    if(state !== "PLAY") return;
    frame++;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Ø³Ù…Ø§Ø¡ ÙˆØ£Ø±Ø¶ÙŠØ©
    ctx.fillStyle = "#87CEEB"; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "#5b3a1d"; ctx.fillRect(0, GROUND, canvas.width, canvas.height-GROUND);
    ctx.fillStyle = "#5da140"; ctx.fillRect(0, GROUND, canvas.width, 10);

    // ÙÙŠØ²ÙŠØ§Ø¡ ØµØ§Ù„Ø­
    player.vy += 0.75;
    player.y += player.vy;
    if(player.y >= GROUND-player.h) { player.y = GROUND-player.h; player.vy = 0; player.jump = false; }
    
    // Ø±Ø³Ù… ØµØ§Ù„Ø­
    ctx.drawImage(assets["Saleh"], player.x, player.y, player.w, player.h);

    // Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø§Ù„Ø¸Ù‡ÙˆØ±
    if(frame >= nextSpawnFrame) spawn();

    obstacles.forEach((o, i) => {
        o.x -= speed;
        if(o.img && o.img.complete) {
            ctx.drawImage(o.img, o.x, o.y, o.w, o.h);
        }

        // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø³Ø±Ø¹Ø©
        if(!o.passed && o.x + o.w < player.x) { 
            score += 14; o.passed = true; 
            speed += 0.08; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ Ù„Ø¬Ø¹Ù„Ù‡Ø§ Ø£ØµØ¹Ø¨
        }
        
        // ØªØµØ§Ø¯Ù… Ø¯Ù‚ÙŠÙ‚
        if(player.x+25 < o.x+o.w-25 && player.x+player.w-25 > o.x+25 && 
           player.y+15 < o.y+o.h-10 && player.y+player.h-10 > o.y+15) {
            gameOver();
        }
    });

    obstacles = obstacles.filter(o => o.x > -200);
    document.getElementById("score").innerText = "Ø§Ù„Ù†Ù‚Ø§Ø·: " + score;
    document.getElementById("top3").innerText = `#1: ${highScores[0]} | #2: ${highScores[1]} | #3: ${highScores[2]}`;
    requestAnimationFrame(loop);
}

function gameOver() {
    state = "OVER";
    document.getElementById("msg").style.display = "flex";
    document.getElementById("msg-text").innerText = "ðŸ’€ Ø³Ù‚Ø· ØµØ§Ù„Ø­! \n Ù†Ù‚Ø§Ø·Ùƒ: " + score;
    document.getElementById("start-btn").innerText = "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©";
    
    highScores.push(score);
    highScores.sort((a,b)=>b-a);
    highScores = highScores.slice(0,3);
    localStorage.setItem("s4leehTop3", JSON.stringify(highScores));
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
window.onload = () => { if(loaded >= toLoad.length) showStartButton(); };
</script>
</body>
</html>
